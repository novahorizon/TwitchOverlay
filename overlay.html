<!DOCTYPE html>
<html>
<head>


<script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.js"></script>
<script>
    let fr = 10;
    let clr;
    let timer = 15.0;
    let display_time = "";
    let cs = 0;
    function setup() {
    createCanvas(400, 100);
    frameRate(fr);
    clr = color(255, 0, 0);
    }

    function draw() {
    display_time = "";
    background(0, 256, 0);
    textSize(70);
    fill(255, 30, 30);
    timer -= deltaTime / 1000;
    if (timer < -5)
        display_time = "";
    else if (timer <= 0)
        display_time = "TIMES UP";
    else {
        if (timer > 3600) {
            display_time += Math.floor(timer / 3600).toString()+":";
            display_time += Math.floor((timer % 3600) / 60).toFixed(0).padStart(2,'0').toString()+":";
        }
        else if (timer > 60)
            display_time += Math.floor((timer % 3600) / 60).toString()+":";
        else
            display_time = "";
        display_time += (timer % 60).toFixed(1).padStart(4,'0');
    }
    text(display_time, 30, 70);
    }

    (async function() {
        const ws = await connectToServer();
    
        async function connectToServer() {
            const ws = new WebSocket('ws://localhost:8079/ws');
            return new Promise((resolve, reject) => {
                const timer = setInterval(() => {
                    if(ws.readyState === 1) {
                        clearInterval(timer)
                        resolve(ws);
                    }
                }, 10);
            });
        }
        ws.onmessage = (webSocketMessage) => {
            const messageBody = JSON.parse(webSocketMessage.data);
            timer = messageBody.timer;
        };
    })();

</script>


</head>
<body>
</body>
</html>
